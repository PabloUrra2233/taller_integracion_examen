{% extends 'catalogo/base.html' %}
{% load humanize %}

{% block title %}Librería - Búsqueda de productos{% endblock %}

{% block navbar_extra %}
<a href="{% url 'crear_producto' %}" class="btn btn-dark">
  Nuevo producto
</a>
<form class="d-flex ms-auto me-2" method="get" action="{% url 'lista_productos' %}">
  {{ form.q }}
  {{ form.categoria }}
  <button class="btn btn-outline-light ms-2" type="submit">Buscar</button>
</form>

{% endblock %}

{% block content %}
<div class="row">
  {% for producto in productos %}
    <div class="col-md-4 mb-4">
      <a href="{% url 'detalle_producto' producto.id %}" class="text-decoration-none text-dark">
        <div class="card h-100">
          <div class="card-img-wrapper">
            {% if producto.imagen %}
              <img src="{{ producto.imagen }}" class="card-img-top" alt="{{ producto.nombre }}">
            {% endif %}
          </div>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ producto.nombre }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">
              {{ producto.categoria.nombre }}
            </h6>
            <p class="card-text flex-grow-1">
              {{ producto.descripcion|truncatechars:150 }}
            </p>
          </div>
          <div class="card-footer d-flex justify-content-between">
            <strong>${{ producto.precio|floatformat:0|intcomma }}</strong>
            <span>Stock: {{ producto.stock }}</span>
          </div>
        </div>
      </a>
    </div>
  {% empty %}
    <p class="empty-message">No se encontraron productos.</p>
  {% endfor %}
</div>
{% endblock %}
